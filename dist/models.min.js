define("models/call",["Backbone"],function(a){"use strict";return a.Model.extend({idAttribute:"id",urlRoot:"call/",isRinging:function(){return"call"===this.get("status")},isUp:function(){return"up"===this.get("status")},isTransfer:function(){return"transfer"===this.get("status")}})}),define("models/customer",["Backbone","utils"],function(a,b){"use strict";return a.Model.extend({idAttribute:"id",urlRoot:"customer/",initialize:function(){this.name=b.getFullName(this.get("first_name"),this.get("last_name"),this.get("middle_name"))}})}),define("models/customers",["Backbone","./customer"],function(a,b){"use strict";return a.Collection.extend({model:b,url:"customer/",parse:function(a){return this.total=a.meta.total,a.data}})}),define("models/interaction",["jquery","underscore","Backbone","utils"],function(a,b,c,d){"use strict";function e(a,c){return a.evaluate(c.condition).then(function(d){var e;return e=b.isArray(d)||b.isObject(d)?b.isEmpty(d)?c.negative:c.positive:d?c.positive:c.negative,a.evaluate(e)})}function f(c,d){return c.evaluate(d.condition).then(function(e){var f=b.isArray(d.cases)?d.cases:[d.cases],g=b.map(f,function(a){return c.evaluate(a.when).then(function(b){return{when:b,value:a.value}})});return a.when.apply(a,g).then(function(){var a=b.find(arguments,function(a){return a.when==e});return c.evaluate(b.isUndefined(a)?d.defaultValue:a.value)})})}function g(d,e){return a.when(d.evaluate(e.where),d.evaluate(e.value)).then(function(a,d){var f=e.property;a instanceof c.Collection&&(a=a.models);var g=b.find(a,function(a){return a instanceof c.Model?a.get(f)==d:a[f]==d});return g instanceof c.Model?g.toJSON():g})}return c.Model.extend({idAttribute:"id",urlRoot:"interaction/",initialize:function(a,b){b=b||{},this.context=b.context||{},this.context.call&&this.context.call.id&&this.set("call_id",this.context.call.id)},evaluate:function(c){return b.isNull(c)||b.isUndefined(c)||b.isBoolean(c)?a.Deferred().resolve(c):b.isString(c)?a.Deferred().resolve(d.interpolateValueString(this,c)):b.isArray(c)?a.when.apply(a,b.map(c,this.evaluate.bind(this))).then(function(){return Array.prototype.slice.call(arguments)}):b.isObject(c)&&b.has(c,"operator")?"if"===c.operator?e(this,c):"switch"===c.operator?f(this,c):"find"===c.operator?g(this,c):a.when(this.evaluate(c.first),this.evaluate(c.second)).then(function(a,b){switch(c.operator){case"eq":return a==b;case"nq":return a!=b;case"gt":return a>b;case"lt":return b>a;case"ge":return a>=b;case"le":return b>=a}}):a.Deferred().resolve(c)},nextStep:function(a){return this.evaluate(a).then(b.bind(function(a){this.trigger("before-next-step"),this.set("step",a);var b=this.get("steps")||[];b.push(a),this.set("steps",b),this.trigger("next-step")},this))},previousStep:function(){var a=this.get("steps")||[];if(a||a.length>0){var b=a.pop();0===a.length?a.push(b):(this.set("step",a[a.length-1]),this.set("steps",a),this.trigger("previous-step"))}}})}),define("models/phone_number",["Backbone"],function(a){"use strict";return a.Model.extend({idAttribute:"id",urlRoot:"phone_number/"})}),define("models/script",["underscore","Backbone"],function(a,b){"use strict";return b.Model.extend({url:"script/",getFirstStepName:function(){var b=this.get("firstStep");return b||(b=a.first(this.get("steps")),b&&(b=b.name)),b},getStep:function(b){var c=this.get("steps")||[],d=a.findIndex(c,function(a){return a.name===b});return 0>d?void 0:c[d]}})}),define("models/user",["Backbone"],function(a){"use strict";return a.Model.extend({idAttribute:"id",urlRoot:"user/"})}),define("models/vehicle",["Backbone"],function(a){"use strict";return a.Model.extend({idAttribute:"id",urlRoot:"vehicle/"})}),define("models/vehicles",["Backbone","./vehicle"],function(a,b){"use strict";return a.Collection.extend({model:b,url:"vehicle/",parse:function(a){return this.total=a.meta.total,a.data}})}),define("models",["underscore","config","utils","models/call","models/customer","models/customers","models/interaction","models/phone_number","models/script","models/user","models/vehicle","models/vehicles"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=Backbone.sync;return Backbone.sync=function(d,e,f){var g=a.result(e,"url");return!f.url&&g&&(f.url=b.apiServer,"/"!==a.last(f.url)&&(f.url+="/"),"/"===a.first(g)?f.url+=g.substr(1):f.url+=g),c.credentials.get().then(function(a){return f.headers=f.headers||{},f.headers.Authorization="user "+window.btoa(a.key+":"+a.secret),m(d,e,f)})},{Call:d,Customer:e,Customers:f,Interaction:g,PhoneNumber:h,Script:i,User:j,Vehicle:k,Vehicles:l}});