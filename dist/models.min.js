AM.define("utils",["underscore","exports"],function(a,b){"use strict";var c=/{{\s*\S+\s*}}/g,d=/^{{\s*(\S*)\s*}}$/,e=b.getStringVariables=function(b){var e=[];return b&&a.isString(b)&&a.each(b.match(c),function(a){var b=a.match(d)[1];b&&e.push(b)}),a.uniq(e.sort(),!0)};b.interpolateValueString=function(b,c){if(a.isString(c)){var d=e(c);if(0===d.length)return c;var f=function(d){var e=new RegExp("{{\\s*"+d+"\\s*}}","g"),f=b.get(d);a.isNull(f)||a.isUndefined(f)||(f=f.toString()),c=c.replace(e,f||"")};if(1!==d.length)a.each(d,f);else{var g=a.first(d),h=b.get(g),i=new RegExp("{{\\s*"+g+"\\s*}}","g");if(c=c.replace(i,"{{"+g+"}}"),c==="{{"+g+"}}")return h;c=c.replace(i,h||"")}}return c}}),AM.define("interaction",["underscore","Backbone","utils"],function(a,b,c){"use strict";return b.Model.extend({idAttribute:"id",urlRoot:"interaction/",evaluate:function(b){if(a.isNull(b)||a.isUndefined(b)||a.isBoolean(b))return b;if(a.isString(b))return c.interpolateValueString(this,b);if(a.isArray(b))return a.map(b,this.evaluate.bind(this));if(a.isObject(b)&&a.has(b,"operator")){var d,e=b.operator;if("if"===e)return d=this.evaluate(b.condition),this.evaluate(a.isEmpty(d)||!d?b.negative:b.positive);if("switch"===e){d=this.evaluate(b.condition);for(var f=a.isArray(b.cases)?b.cases:[b.cases],g=0,h=f.length;h>g;g++){var i=f[g];if(this.evaluate(i.when)===d)return this.evaluate(i.value)}return this.evaluate(b.defaultValue)}}return b},nextStep:function(a){a=this.evaluate(a),this.set("step",a);var b=this.get("steps")||[];b.push(a),this.set("steps",b),this.trigger("next-step")},previousStep:function(){var a=this.get("steps")||[];if(a||a.length>0){var b=a.pop();0===a.length?a.push(b):(this.set("step",a[a.length-1]),this.set("steps",a),this.trigger("previous-step"))}}})}),AM.define("script",["underscore","Backbone"],function(a,b){"use strict";return b.Model.extend({url:"script/",getFirstStepName:function(){var b=this.get("firstStep");return b||(b=a.first(this.get("steps")),b&&(b=b.name)),b},getStep:function(b){var c=this.get("steps")||[],d=a.findIndex(c,function(a){return a.name===b});return 0>d?void 0:c[d]}})}),AM.define("models",["interaction","script"],function(a,b){"use strict";return{Interaction:a,Script:b}});